<!-- https://gohugo.io/hugo-pipes/js/#examples -->
<!-- TODO remove arrive js dependancy -->
{{ $js := resources.Get "js/arrive.min.js" | js.Build "arrive.min.js" }}
<script type="text/javascript" src="{{ $js.RelPermalink }}" defer></script>

<!-- {{ $commentOpenIcon := resources.Get "icons/comment.svg" }} {{ $commentCloseIcon
:= resources.Get "icons/comment-close.svg" }} -->
{{ $commentTransitionIcon := resources.Get "icons/icon.svg" }}
<div id="show-comments">
  <!-- https://discourse.gohugo.io/t/readfile-from-resource/18800/4 -->
  <!-- {{ $commentOpenIcon.Content | htmlUnescape | safeHTML }} {{
  $commentCloseIcon.Content | htmlUnescape | safeHTML }}-->
  {{ $commentTransitionIcon.Content | htmlUnescape | safeHTML }}
</div>
<style>
  @keyframes slidein {
    from {
      opacity: 0;
      transform: translate(0px, -30px) !important;
    }
    to {
      opacity: 1;
      transform: translate(0px, 0px) !important;
    }
  }
  @keyframes slideout {
    from {
      opacity: 1;
      transform: translate(0px, 0px) !important;
    }
    to {
      opacity: 0;
      transform: translate(0px, -30px) !important;
    }
  }
  .hide {
    animation: slideout 1s ease forwards;
  }
  .show {
    animation: slidein 1s ease forwards;
  }
  .comments {
    position: fixed;
    min-width: clamp(60%, 585px, 80%);
    bottom: 9vh;
    transform: translate(-3%, 0px);
    right: 0;
    opacity: 0;
    background: black;
    padding: 2vw;
    border-radius: 3%;
    box-shadow: 0 5px 4px 0 rgb(0 0 0 / 26%);
  }
  #show-comments {
    position: fixed;
    padding: 10px;
    bottom: 1vh;
    z-index: 3;
    border-radius: 200px;
    right: 1vw;
    box-shadow: 0 5px 4px 0 rgb(0 0 0 / 26%);
  }
  #show-comments:hover {
    cursor: pointer;
    color: #28c5ca;
    background: rgb(75, 72, 72);
  }
  #show-comments > svg {
    fill: #38ada7;
    height: 30px;
    transform: translate(-6%, 17%) scale(0.785);
  }
</style>
<div class="comments"></div>
<script type="text/javascript">
  var utter = document.querySelector(".utterances");
  const commentsBox = document.querySelector(".comments");
  const commentBtn = document.querySelector("#show-comments");
  commentBtn.onclick = (ev) => toggleComments(ev);
  var showing = false;
  const comments = `<script
    src="https://utteranc.es/client.js"
    repo="phanirithvij/phanirithvij.github.io"
    issue-term="pathname"
    label="comment"
    id="utter-script"
    theme="preferred-color-scheme"
    crossorigin="anonymous"/>`;
  function toggleComments(ev) {
    if (showing) hideComments();
    else showComments();
    showing = !showing;
    // onclick outside svg icon but on button(div)
    if (ev.target.id === "show-comments") {
      // https://stackoverflow.com/a/49835939/8608146
      // svg has no click method
      commentBtn.querySelector("svg").dispatchEvent(new Event("click"));
    }
  }
  function showComments() {
    if (utter != null) {
      toggleCommentVisibility();
      return;
    }
    // https://stackoverflow.com/a/62641523/8608146
    const scriptEl = document.createRange().createContextualFragment(comments);
    commentsBox.appendChild(scriptEl);
    // using arrive.js to trigger onload for .utterances div
    // which will be created by 3rd party utterances.js
    document.arrive(".utterances", function () {
      // can be useful if doing a loading icon
      utter = document.querySelector(".utterances");
    });
    toggleCommentVisibility();
  }
  function toggleCommentVisibility() {
    if (utter != null) {
      if (utter.classList.contains("hide")) {
        utter.classList.remove("hide");
        utter.classList.add("show");
      } else {
        utter.classList.remove("show");
        utter.classList.add("hide");
      }
    }
    if (commentsBox.classList.contains("show")) {
      commentsBox.classList.remove("show");
      commentsBox.classList.add("hide");
    } else {
      commentsBox.classList.remove("hide");
      commentsBox.classList.add("show");
    }
  }
  function hideComments() {
    console.log("hide comments");
    toggleCommentVisibility();
  }
</script>
